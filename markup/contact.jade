doctype html
html
  head
    include includes/head
    script(src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.15/angular.min.js")
    script(src="//fgnass.github.io/spin.js/spin.min.js")
    script.
      var myApp = angular.module('mayOne',[]);
      myApp.controller('ContactController',
                       ['$scope', '$http', function($scope, $http) {
        $scope.ctrl = {
          spinning: false,
          submitting : false,
          submitted: false,
          error : '',
          name : '',
          email : '',
          subject : '',
          body : '',
          submit : function() {
            var spin_opts = {
                  lines: 13,
                  length: 10, // The length of each line
                  width: 5, // The line thickness
                  radius: 15, // The radius of the inner circle
                  corners: 1, // Corner roundness (0..1)
                  rotate: 0, // The rotation offset
                  direction: 1, // 1: clockwise, -1: counterclockwise
                  color: '#2b669a', // #rgb or #rrggbb or array of colors
                  speed: 1, // Rounds per second
                  trail: 60, // Afterglow percentage
                  shadow: false, // Whether to render a shadow
                  hwaccel: false, // Whether to use hardware acceleration
                  className: 'spinner', // The CSS class to assign to the spinner
                  zIndex: 2e9, // The z-index (defaults to 2000000000)
                  top: '50%', // Top position relative to parent
                  left: '50%' // Left position relative to parent
            };
            $scope.ctrl.spinning = true;
            var target = document.getElementById('spinButton');
            var spinner = new Spinner(spin_opts).spin(target);
            $http.post('/contact.us', {
              name: $scope.ctrl.name,
              email: $scope.ctrl.email,
              subject: $scope.ctrl.subject,
              body: $scope.ctrl.body
            }).success(function(data, status) {
              spinner.stop();
              $scope.ctrl.submitted = true;
              $scope.ctrl.spinning = false;
            }).error(function() {
              spinner.stop();
              $scope.ctrl.spinning = false;
              $scope.ctrl.error =
                'Oops, something went wrong. Try again in a few minutes';
            });
          },
        };
      }]);

  body#contact(ng-app="mayOne", ng-controller="ContactController")
    include includes/header
    .container
      .row
        .page-header
          h1 Contact Us
      #content.row
        .col-md-8
          .row
            form(ng-submit="ctrl.submit()", ng-show="! ctrl.submitted")
             .row
              .col-md-12
                label Name (required)
                .input-group.input-group-lg
                  input.form-control(type="text", required, ng-model="ctrl.name")
             .row
              .col-md-12
                label Email (required)
                .input-group.input-group-lg
                  input.form-control(type="email", required, ng-model="ctrl.email")
             .row
              .col-md-12
                label Subject
                .input-group.input-group-lg
                  input.form-control(type="text", required, ng-model="ctrl.subject")
             .row
              .col-md-12
                label Message
                .input-group.input-group-lg
                  textarea.col-md-12(rows="10", ng-model="ctrl.body")
             .row(ng-show="! ctrl.spinning")
              .col-md-12
                  span.input-group-btn
                    button.btn.btn-primary(id="submitButton", type="submit") Send
             .row(ng-show="ctrl.spinning")
              .spacing(id="spinButton")
            .butterbar.row(ng-show="ctrl.error")
              .alert.alert-danger {{ctrl.error}}
             .row(ng-show="ctrl.submitted")
              .col-md-12
                p.
                  Thank you for your message.  We will respond as soon as we can.
                p.
                  You are also welcome to explore <a href="//mayone.us/connect">our other ways to connect</a>.
    .spacing
    include includes/footer
